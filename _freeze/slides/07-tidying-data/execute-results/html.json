{
<<<<<<< HEAD
  "hash": "934538185a8e3edadb8480f06f368bbf",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Tidying data\"\nsubtitle: \"Lecture 7\"\ndate: \"2025-09-16\"\nformat: \n  revealjs: \n    output-file: 07-tidying-data-slides.html\n    footer: \"[ðŸ”— sta199-f25.github.io](https://sta199-f25.github.io/)\"\n    theme: slides.scss\n    transition: fade\n    slide-number: true\n    logo: images/logo.png\n    toc: false\n  html: \n    code-link: true\n---\n\n\n\n# Warm-up\n\n## While you wait: Participate ðŸ“±ðŸ’» {.xsmall}\n\n\n\n\n\n::: {.columns}\n\n::: {.column width=\"85%\"}\n\n::: wooclap\nWhich of the following plots does this code produce?\n\n\n::: {.cell}\n\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(gerrymander, aes(x = gerry, y = clinton16)) +\n  geom_boxplot(aes(color = gerry)) +\n  geom_beeswarm() +\n  labs(title = \"O\")\n```\n:::\n\n\n\n::: {.cell layout-ncol=\"2\"}\n::: {.cell-output-display}\n![](07-tidying-data_files/figure-revealjs/unnamed-chunk-5-1.png){width=480}\n:::\n\n::: {.cell-output-display}\n![](07-tidying-data_files/figure-revealjs/unnamed-chunk-5-2.png){width=480}\n:::\n\n::: {.cell-output-display}\n![](07-tidying-data_files/figure-revealjs/unnamed-chunk-5-3.png){width=480}\n:::\n\n::: {.cell-output-display}\n![](07-tidying-data_files/figure-revealjs/unnamed-chunk-5-4.png){width=480}\n:::\n:::\n\n\n:::\n\n:::\n\n::: {.column width=\"15%\"}\n\n![](images/wooclap-qr.png){width=\"200\" fig-align=\"center\"}\n\n::: small\nScan the QR code or go to [app.wooclap.com/sta199](https://app.wooclap.com/sta199). Log in with your Duke NetID.\n:::\n\n\n:::\n\n::: \n\n\n## Announcements\n\n- 1\n- 2\n- ...\n\n## Recap: layering geoms {.scrollable .smaller}\n\n::: columns\n::: {.column width=\"60%\"}\n::: task\nUpdate the following code to create the visualization on the right.\n:::\n\n:::\n\n::: {.column width=\"40%\"}\n![](images/07/gerrymander-recreate.png)\n:::\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(gerrymander, aes(x = gerry, y = clinton16)) +\n  geom_boxplot(aes(color = gerry)) +\n  geom_beeswarm()\n```\n\n::: {.cell-output-display}\n![](07-tidying-data_files/figure-revealjs/unnamed-chunk-6-1.png){width=960}\n:::\n:::\n\n\n## Recap: layering geoms {.smaller}\n\n1. Swap the order of the two geoms.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"|2,3\"}\nggplot(gerrymander, aes(x = gerry, y = clinton16)) +\n  geom_beeswarm() +\n  geom_boxplot(aes(color = gerry))\n```\n\n::: {.cell-output-display}\n![](07-tidying-data_files/figure-revealjs/unnamed-chunk-7-1.png){width=960}\n:::\n:::\n\n\n## Recap: layering geoms {.smaller}\n\n2. Make the boxplots semi-transparent.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"|3\"}\nggplot(gerrymander, aes(x = gerry, y = clinton16)) +\n  geom_beeswarm() +\n  geom_boxplot(aes(color = gerry), alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](07-tidying-data_files/figure-revealjs/unnamed-chunk-8-1.png){width=960}\n:::\n:::\n\n\n## Recap: layering geoms {.smaller}\n\n3. Remove the legend.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"|3\"}\nggplot(gerrymander, aes(x = gerry, y = clinton16)) +\n  geom_beeswarm() +\n  geom_boxplot(aes(color = gerry), alpha = 0.5, show.legend = FALSE)\n```\n\n::: {.cell-output-display}\n![](07-tidying-data_files/figure-revealjs/unnamed-chunk-9-1.png){width=960}\n:::\n:::\n\n\n## Recap: logical operators {.smaller}\n\nGenerally useful in a `filter()` but will come up in various other places as well...\n\n| operator | definition                                |\n|:---------|:------------------------------------------|\n| `<`      | [is less than?]{.fragment}                |\n| `<=`     | [is less than or equal to?]{.fragment}    |\n| `>`      | [is greater than?]{.fragment}             |\n| `>=`     | [is greater than or equal to?]{.fragment} |\n| `==`     | [is exactly equal to?]{.fragment}         |\n| `!=`     | [is not equal to?]{.fragment}             |\n\n: {tbl-colwidths=\"\\[25,75\\]\"}\n\n## Recap: logical operators (cont.) {.smaller}\n\nGenerally useful in a `filter()` but will come up in various other places as well...\n\n| operator      | definition                                                            |\n|:--------------|:----------------------------------------------------------------------|\n| `x & y`       | [is x AND y?]{.fragment}                                              |\n| `x | y`      | [is x OR y?]{.fragment}                                               |\n| `is.na(x)`    | [is x NA?]{.fragment}                                                 |\n| `!is.na(x)`   | [is x not NA?]{.fragment}                                             |\n| `x %in% y`    | [is x in y?]{.fragment}                                               |\n| `!(x %in% y)` | [is x not in y?]{.fragment}                                           |\n| `!x`          | [is not x? (only makes sense if `x` is `TRUE` or `FALSE`)]{.fragment} |\n\n: {tbl-colwidths=\"\\[25,75\\]\"}\n\n## Recap: assignment {.smaller}\n\nLet's make a tiny data frame to use as an example:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- tibble(x = c(1, 2, 3, 4, 5),\n             y = c(\"a\", \"a\", \"b\", \"c\", \"c\"))\ndf\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 Ã— 2\n      x y    \n  <dbl> <chr>\n1     1 a    \n2     2 a    \n3     3 b    \n4     4 c    \n5     5 c    \n```\n\n\n:::\n:::\n\n\n## Recap: assignment {.smaller}\n\n::: question\nSuppose you run the following and **then** you inspect `df`.  Will the `x` variable have values `1, 2, 3, 4, 5` **or** `2, 4, 6, 8, 10`?\n:::\n\n::: columns\n::: column\n\n::: {.cell}\n\n```{.r .cell-code}\ndf |>\n  mutate(x = x * 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 Ã— 2\n      x y    \n  <dbl> <chr>\n1     2 a    \n2     4 a    \n3     6 b    \n4     8 c    \n5    10 c    \n```\n\n\n:::\n:::\n\n:::\n\n::: {.column .fragment}\n\n::: {.cell}\n\n```{.r .cell-code}\ndf\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 Ã— 2\n      x y    \n  <dbl> <chr>\n1     1 a    \n2     2 a    \n3     3 b    \n4     4 c    \n5     5 c    \n```\n\n\n:::\n:::\n\n:::\n:::\n\n. . .\n\n> **Do something and show me**\n\n## Recap: assignment {.smaller}\n\n::: question\nSuppose you run the following and **then** you inspect `df`.  Will the `x` variable have values `1, 2, 3, 4, 5` **or** `2, 4, 6, 8, 10`?\n:::\n\n::: columns\n::: column\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- df |>\n  mutate(x = x * 2)\n```\n:::\n\n:::\n\n::: {.column .fragment}\n\n::: {.cell}\n\n```{.r .cell-code}\ndf\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 Ã— 2\n      x y    \n  <dbl> <chr>\n1     2 a    \n2     4 a    \n3     6 b    \n4     8 c    \n5    10 c    \n```\n\n\n:::\n:::\n\n:::\n:::\n\n. . .\n\n> **Do something and save result**\n\n## Recap: assignment {.smaller}\n\n::: columns\n::: {.column .fragment width=\"50%\"}\n> **Do something, save result, overwriting original**\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"5-7\"}\ndf <- tibble(\n  x = c(1, 2, 3, 4, 5), \n  y = c(\"a\", \"a\", \"b\", \"c\", \"c\")\n)\ndf <- df |>\n  mutate(x = x * 2)\ndf\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 Ã— 2\n      x y    \n  <dbl> <chr>\n1     2 a    \n2     4 a    \n3     6 b    \n4     8 c    \n5    10 c    \n```\n\n\n:::\n:::\n\n:::\n\n::: {.column .fragment width=\"50%\"}\n> **Do something, save result, *not* overwriting original**\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"5-7\"}\ndf <- tibble(\n  x = c(1, 2, 3, 4, 5), \n  y = c(\"a\", \"a\", \"b\", \"c\", \"c\")\n)\ndf_new <- df |>\n  mutate(x = x * 2)\ndf_new\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 Ã— 2\n      x y    \n  <dbl> <chr>\n1     2 a    \n2     4 a    \n3     6 b    \n4     8 c    \n5    10 c    \n```\n\n\n:::\n:::\n\n:::\n:::\n\n## Recap: assignment {.smaller}\n\n::: columns\n::: {.column .fragment width=\"50%\"}\n> **Do something, save result, overwriting original *when you shouldn't***\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"5-8\"}\ndf <- tibble(\n  x = c(1, 2, 3, 4, 5), \n  y = c(\"a\", \"a\", \"b\", \"c\", \"c\")\n)\ndf <- df |>\n  group_by(y) |>\n  summarize(mean_x = mean(x))\ndf\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 Ã— 2\n  y     mean_x\n  <chr>  <dbl>\n1 a        1.5\n2 b        3  \n3 c        4.5\n```\n\n\n:::\n:::\n\n:::\n\n::: {.column .fragment width=\"50%\"}\n> **Do something, save result, *not* overwriting original *when you shouldn't***\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"5-8\"}\ndf <- tibble(\n  x = c(1, 2, 3, 4, 5), \n  y = c(\"a\", \"a\", \"b\", \"c\", \"c\")\n)\ndf_summary <- df |>\n  group_by(y) |>\n  summarize(mean_x = mean(x))\ndf_summary\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 Ã— 2\n  y     mean_x\n  <chr>  <dbl>\n1 a        1.5\n2 b        3  \n3 c        4.5\n```\n\n\n:::\n:::\n\n:::\n:::\n\n## Recap: assignment {.smaller}\n\n::: columns\n::: {.column .fragment width=\"50%\"}\n> **Do something, save result, overwriting original**\\\n> ***data frame***\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"5-7\"}\ndf <- tibble(\n  x = c(1, 2, 3, 4, 5), \n  y = c(\"a\", \"a\", \"b\", \"c\", \"c\")\n)\ndf <- df |>\n  mutate(z = x + 2)\ndf\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 Ã— 3\n      x y         z\n  <dbl> <chr> <dbl>\n1     1 a         3\n2     2 a         4\n3     3 b         5\n4     4 c         6\n5     5 c         7\n```\n\n\n:::\n:::\n\n:::\n\n::: {.column .fragment width=\"50%\"}\n> **Do something, save result, overwriting original**\\\n> ***column***\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"5-7\"}\ndf <- tibble(\n  x = c(1, 2, 3, 4, 5), \n  y = c(\"a\", \"a\", \"b\", \"c\", \"c\")\n)\ndf <- df |>\n  mutate(x = x + 2)\ndf\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 Ã— 2\n      x y    \n  <dbl> <chr>\n1     3 a    \n2     4 a    \n3     5 b    \n4     6 c    \n5     7 c    \n```\n\n\n:::\n:::\n\n:::\n:::\n\n# Data tidying\n\n## Tidy data\n\n> \"Tidy datasets are easy to manipulate, model and visualise, and have a specific structure: each variable is a column, each observation is a row, and each type of observational unit is a table.\"\n>\n> Tidy Data, <https://vita.had.co.nz/papers/tidy-data.pdf>\n\n. . .\n\n**Note:** \"easy to manipulate\" = \"straightforward to manipulate\"\n\n## Goal\n\nVisualize StatSci majors over the years!\n\n![](images/07/statsci-majors.png)\n\n## Data {.smaller}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstatsci\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 Ã— 16\n  degree_type `2011` `2012` `2013` `2014` `2015` `2016` `2017` `2018`\n  <chr>        <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>\n1 AB2              0      1      0      0      4      4      1      0\n2 AB               2      2      4      1      3      6      3      4\n3 BS2              2      6      1      0      5      6      6      8\n4 BS               5      9      4     13     10     17     24     21\n# â„¹ 7 more variables: `2019` <dbl>, `2020` <dbl>, `2021` <dbl>,\n#   `2022` <dbl>, `2023` <dbl>, `2024` <dbl>, `2025` <dbl>\n```\n\n\n:::\n:::\n\n\n. . . \n\n::: incremental\n-   The first column (variable) is the `degree`: \n\n    ::: {.small}\n    - BS (Bachelor of Science)\n    - BS2 (Bachelor of Science, 2nd major)\n    - AB (Bachelor of Arts)\n    - AB2 (Bachelor of Arts, 2nd major)\n    :::\n    \n-   The remaining columns show the number of students graduating with that major in a given academic year from 2011 to 2025.\n:::\n\n## Let's plan! {.smaller .nostretch}\n\nReview the goal plot and sketch the data frame needed to create it.\nWhat would go inside `aes` when we call `ggplot`?\n\n\n![](images/07/statsci-majors.png){width=\"500\"}\n\n## The Goal {.smaller .nostretch}\n\nWe want to write code that starts something like this:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(statsci, aes(x = year, y = n, color = degree_type)) + \n  ...\n```\n:::\n\n\n\n. . . \n\n\n<br>\n\n\nBut our data are not in the right format :(\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstatsci\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 Ã— 16\n  degree_type `2011` `2012` `2013` `2014` `2015` `2016` `2017` `2018`\n  <chr>        <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>\n1 AB2              0      1      0      0      4      4      1      0\n2 AB               2      2      4      1      3      6      3      4\n3 BS2              2      6      1      0      5      6      6      8\n4 BS               5      9      4     13     10     17     24     21\n# â„¹ 7 more variables: `2019` <dbl>, `2020` <dbl>, `2021` <dbl>,\n#   `2022` <dbl>, `2023` <dbl>, `2024` <dbl>, `2025` <dbl>\n```\n\n\n:::\n:::\n\n\n## The Challenge {.smaller .nostretch}\n\n::: {.columns}\n\n::: {.column width=\"70%\"}\n\n***How do we go from this ....***\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 x 16\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  degree_type 2011 2012 2013 2014 2015 2016 2017 2018 2019\n1         AB2    0    1    0    0    4    4    1    0    0\n2          AB    2    2    4    1    3    6    3    4    4\n3         BS2    2    6    1    0    5    6    6    8    8\n4          BS    5    9    4   13   10   17   24   21   26\n```\n\n\n:::\n:::\n\n\n:::\n\n\n::: {.column .fragment width=\"30%\"}\n\n***.... to this??***\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 60 x 3\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   degree_type year n\n1          AB2 2011 0\n2          AB2 2012 1\n3          AB2 2013 0\n4          AB2 2014 0\n5          AB2 2015 4\n6          AB2 2016 4\n7          AB2 2017 1\n8          AB2 2018 0\n9          AB2 2019 0\n10         AB2 2020 1\n11         AB2 2021 2\n12         AB2 2022 0\n13         AB2 2023 3\n14         AB2 2024 1\n15         AB2 2025 0\n16          AB 2011 2\n17          AB 2012 2\n```\n\n\n:::\n:::\n\n::: \n:::\n\n. . . \n\nThe answer:  `pivot_longer()`\n\n# Pivot\n\n## `pivot_longer()` {.smaller .scrollable}\n\n::: task\nPivot the `statsci` data frame *longer* such that each row represents a degree type / year combination and `year` and `n`umber of graduates for that year are columns in the data frame.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# add code here\n```\n:::\n\n\n## `year`\n\n::: question\nWhat is the type of the `year` variable?\nWhy?\nWhat should it be?\n:::\n\n. . .\n\nIt's a character (`chr`) variable since the information came from the columns of the original data frame and R cannot know that these character strings represent years.\nThe variable type should be numeric.\n\n## `pivot_longer()` again {.smaller .scrollable}\n\n::: question\nStart over with pivoting, and this time also make sure `year` is a numerical variable in the resulting data frame.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstatsci |>\n  pivot_longer(\n    cols = -degree,\n    names_to = \"year\",\n    names_transform = as.numeric,\n    # ???\n  )\n```\n:::\n\n\n## `NA` counts\n\n::: question\nWhat does an `NA` mean in this context?\n*Hint:* The data come from the university registrar, and they have records on every single graduates, there shouldn't be anything \"unknown\" to them about who graduated when.\n:::\n\n. . .\n\n`NA`s should actually be 0s.\n\n## Clean-up {.smaller .scrollable}\n\n::: task\nAdd on to your pipeline that you started with pivoting and convert `NA`s in `n` to `0`s.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstatsci |>\n  pivot_longer(\n    cols = -degree,\n    names_to = \"year\",\n    names_transform = as.numeric,\n    values_to = \"n\"\n  ) |>\n  # ???\n```\n:::\n\n\n## More clean-up {.smaller .scrollable}\n\n::: task\nIn our plot the degree types are BS, BS2, AB, and AB2.\nThis information is in our dataset, in the `degree` column, but this column also has additional characters we don't need.\nCreate a new column called `degree_type` with levels BS, BS2, AB, and AB2 (in this order) based on `degree`.\nDo this by adding on to your pipeline from earlier.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstatsci |>\n  pivot_longer(\n    cols = -degree,\n    names_to = \"year\",\n    names_transform = as.numeric,\n    values_to = \"n\"\n  ) |>\n  mutate(n = if_else(is.na(n), 0, n)) |>\n  # ???\n```\n:::\n\n\n## Finish {.smaller .scrollable}\n\n::: task\nNow that you have your data pivoting and cleaning pipeline figured out, save the resulting data frame as `statsci_longer`.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstatsci |>\n  pivot_longer(\n    cols = -degree,\n    names_to = \"year\",\n    names_transform = as.numeric,\n    values_to = \"n\"\n  ) |>\n  mutate(n = if_else(is.na(n), 0, n)) |>\n  separate(degree, sep = \" \\\\(\", into = c(\"major\", \"degree_type\")) |>\n  mutate(\n    degree_type = str_remove(degree_type, \"\\\\)\"),\n    degree_type = fct_relevel(degree_type, \"BS\", \"BS2\", \"AB\", \"AB2\")\n  )\n```\n:::\n\n\n# Application exercise\n\n## ae\\-05\\-majors\\-tidy {.smaller}\n\n::: appex\n-   Go to your ae project in RStudio.\n\n-   If you haven't yet done so, make sure all of your changes up to this point are committed and pushed, i.e., there's nothing left in your Git pane.\n\n-   If you haven't yet done so, click Pull to get today's application exercise file: *ae\\-05\\-majors\\-tidy\\.qmd*.\n\n-   Work through the application exercise in class, and render, commit, and push your edits by the end of class.\n:::\n\n## Recap: pivoting {.smaller}\n\n::: incremental\n-   Data sets can't be labeled as *wide* or *long* but they can be made *wider* or *longer* for a certain analysis that requires a certain format\n-   When pivoting longer, variable names that turn into values are characters by default. If you need them to be in another format, you need to explicitly make that transformation, which you can do so within the `pivot_longer()` function.\n-   You can tweak a plot forever, but at some point the tweaks are likely not very productive. However, you should always be critical of defaults (however pretty they might be) and see if you can improve the plot to better portray your data / results / what you want to communicate.\n:::\n",
=======
  "hash": "6729677655ba6627bfc85ad5b1611e0d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Tidying data\"\nsubtitle: \"Lecture 7\"\ndate: \"2025-09-16\"\nauthor: \"Guest lecture by Marie Neubrander <br><br>Dr. Mine Ã‡etinkaya-Rundel\"\nformat: \n  revealjs: \n    output-file: 07-tidying-data-slides.html\n    footer: \"[ðŸ”— sta199-f25.github.io](https://sta199-f25.github.io/)\"\n    theme: slides.scss\n    transition: fade\n    slide-number: true\n    logo: images/logo.png\n    toc: false\n  html: \n    code-link: true\n---\n\n\n\n# Warm-up\n\n## While you wait: Participate ðŸ“±ðŸ’» {.xsmall}\n\n\n\n::: {.columns}\n\n::: {.column width=\"85%\"}\n\n::: wooclap\nWhich of the following plots does this code produce?\n\n\n::: {.cell}\n\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(gerrymander, aes(x = gerry, y = clinton16)) +\n  geom_boxplot(aes(color = gerry)) +\n  geom_beeswarm()\n```\n:::\n\n\n\n::: {.cell layout-ncol=\"2\"}\n::: {.cell-output-display}\n![](07-tidying-data_files/figure-revealjs/unnamed-chunk-4-1.png){width=480}\n:::\n\n::: {.cell-output-display}\n![](07-tidying-data_files/figure-revealjs/unnamed-chunk-4-2.png){width=480}\n:::\n\n::: {.cell-output-display}\n![](07-tidying-data_files/figure-revealjs/unnamed-chunk-4-3.png){width=480}\n:::\n\n::: {.cell-output-display}\n![](07-tidying-data_files/figure-revealjs/unnamed-chunk-4-4.png){width=480}\n:::\n:::\n\n\n:::\n\n:::\n\n::: {.column width=\"15%\"}\n\n![](images/wooclap-qr.png){width=\"200\" fig-align=\"center\"}\n\n::: small\nScan the QR code or go to [app.wooclap.com/sta199](https://app.wooclap.com/sta199). Log in with your Duke NetID.\n:::\n\n\n:::\n\n::: \n\n\n## Announcements\n\n- 1\n- 2\n- ...\n\n## Recap: layering geoms {.scrollable .smaller}\n\n::: columns\n::: {.column width=\"60%\"}\n::: task\nUpdate the following code to create the visualization on the right.\n:::\n\n:::\n\n::: {.column width=\"40%\"}\n![](images/07/gerrymander-recreate.png)\n:::\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(gerrymander, aes(x = gerry, y = clinton16)) +\n  geom_boxplot(aes(color = gerry)) +\n  geom_beeswarm()\n```\n\n::: {.cell-output-display}\n![](07-tidying-data_files/figure-revealjs/unnamed-chunk-5-1.png){width=960}\n:::\n:::\n\n\n## Recap: layering geoms {.smaller}\n\n1. Swap the order of the two geoms.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"|2,3\"}\nggplot(gerrymander, aes(x = gerry, y = clinton16)) +\n  geom_beeswarm() +\n  geom_boxplot(aes(color = gerry))\n```\n\n::: {.cell-output-display}\n![](07-tidying-data_files/figure-revealjs/unnamed-chunk-6-1.png){width=960}\n:::\n:::\n\n\n## Recap: layering geoms {.smaller}\n\n2. Make the boxplots semi-transparent.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"|3\"}\nggplot(gerrymander, aes(x = gerry, y = clinton16)) +\n  geom_beeswarm() +\n  geom_boxplot(aes(color = gerry), alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](07-tidying-data_files/figure-revealjs/unnamed-chunk-7-1.png){width=960}\n:::\n:::\n\n\n## Recap: layering geoms {.smaller}\n\n3. Remove the legend.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"|3\"}\nggplot(gerrymander, aes(x = gerry, y = clinton16)) +\n  geom_beeswarm() +\n  geom_boxplot(aes(color = gerry), alpha = 0.5, show.legend = FALSE)\n```\n\n::: {.cell-output-display}\n![](07-tidying-data_files/figure-revealjs/unnamed-chunk-8-1.png){width=960}\n:::\n:::\n\n\n## Recap: logical operators {.smaller}\n\nGenerally useful in a `filter()` but will come up in various other places as well...\n\n| operator | definition                                |\n|:---------|:------------------------------------------|\n| `<`      | [is less than?]{.fragment}                |\n| `>`      | [is greater than?]{.fragment}             |\n\n: {tbl-colwidths=\"\\[25,75\\]\"}\n\n## Recap: Participate ðŸ“±ðŸ’» {.xsmall}\n\n::: {.columns}\n\n::: {.column width=\"70%\"}\n\n::: wooclap\nMatch the following logical operators to their definitions.\n\n::: wooclap-choices\n- `<=`\n- `>=`\n- `==`\n- `!=`\n:::\n\n:::\n\n:::\n\n::: {.column width=\"30%\"}\n\n![](images/wooclap-qr.png){width=\"200\" fig-align=\"center\"}\n\n::: small\nScan the QR code or go to [app.wooclap.com/sta199](https://app.wooclap.com/sta199). Log in with your Duke NetID.\n:::\n\n\n:::\n\n:::\n\n## Recap: Participate ðŸ“±ðŸ’» {.xsmall}\n\n::: {.columns}\n\n::: {.column width=\"70%\"}\n\n::: wooclap\nMatch the following definitions to their logical operators.\n\n::: wooclap-choices\n- is x AND y?\n- is x OR y?\n- is x NA?\n- is x not NA?\n:::\n\n:::\n\n:::\n\n::: {.column width=\"30%\"}\n\n![](images/wooclap-qr.png){width=\"200\" fig-align=\"center\"}\n\n::: small\nScan the QR code or go to [app.wooclap.com/sta199](https://app.wooclap.com/sta199). Log in with your Duke NetID.\n:::\n\n\n:::\n\n:::\n\n## Recap: logical operators (cont.) {.smaller}\n\nOther useful logical operators:\n\n| operator      | definition                                                            |\n|:--------------|:----------------------------------------------------------------------|\n| `x %in% y`    | [is x in y?]{.fragment}                                               |\n| `!(x %in% y)` | [is x not in y?]{.fragment}                                           |\n| `!x`          | [is not x? (only makes sense if `x` is `TRUE` or `FALSE`)]{.fragment} |\n\n: {tbl-colwidths=\"\\[25,75\\]\"}\n\n# Data tidying\n\n## Tidy data\n\n> \"Tidy datasets are easy to manipulate, model and visualise, and have a specific structure: each variable is a column, each observation is a row, and each type of observational unit is a table.\"\n>\n> Tidy Data, <https://vita.had.co.nz/papers/tidy-data.pdf>\n\n. . .\n\n**Note:** \"easy to manipulate\" = \"straightforward to manipulate\"\n\n## Goal\n\nVisualize StatSci majors over the years!\n\n![](images/07/statsci-majors.png)\n\n**TO DO:** Update with plot from end of AE\n\n## Data {.smaller}\n\n\n\n-   The first column (variable) is the `degree`, and there are 4 possible degrees: BS (Bachelor of Science), BS2 (Bachelor of Science, 2nd major), AB (Bachelor of Arts), AB2 (Bachelor of Arts, 2nd major).\n\n-   The remaining columns show the number of students graduating with that major in a given academic year from 2011 to 2025.\n\n## Let's plan! {.smaller .nostretch}\n\n::: question\nReview the goal plot and sketch the data frame needed to make the plot.\nDetermine rows and columns of the data frame.\n*Hint:* Data need to be in columns to map to `aes`thetic elements of the plot.\n:::\n\n![](images/07/statsci-majors.png){width=\"500\"}\n\n# Pivot\n\n## `pivot_longer()` {.smaller .scrollable}\n\n::: task\nPivot the `statsci` data frame *longer* such that each row represents a degree type / year combination and `year` and `n`umber of graduates for that year are columns in the data frame.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# add code here\n```\n:::\n\n\n## `year`\n\n::: question\nWhat is the type of the `year` variable?\nWhy?\nWhat should it be?\n:::\n\n. . .\n\nIt's a character (`chr`) variable since the information came from the columns of the original data frame and R cannot know that these character strings represent years.\nThe variable type should be numeric.\n\n## `pivot_longer()` again {.smaller .scrollable}\n\n::: question\nStart over with pivoting, and this time also make sure `year` is a numerical variable in the resulting data frame.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstatsci |>\n  pivot_longer(\n    cols = -degree,\n    names_to = \"year\",\n    names_transform = as.numeric,\n    # ???\n  )\n```\n:::\n\n\n## `NA` counts\n\n::: question\nWhat does an `NA` mean in this context?\n*Hint:* The data come from the university registrar, and they have records on every single graduates, there shouldn't be anything \"unknown\" to them about who graduated when.\n:::\n\n. . .\n\n`NA`s should actually be 0s.\n\n## Clean-up {.smaller .scrollable}\n\n::: task\nAdd on to your pipeline that you started with pivoting and convert `NA`s in `n` to `0`s.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstatsci |>\n  pivot_longer(\n    cols = -degree,\n    names_to = \"year\",\n    names_transform = as.numeric,\n    values_to = \"n\"\n  ) |>\n  # ???\n```\n:::\n\n\n## More clean-up {.smaller .scrollable}\n\n::: task\nIn our plot the degree types are BS, BS2, AB, and AB2.\nThis information is in our dataset, in the `degree` column, but this column also has additional characters we don't need.\nCreate a new column called `degree_type` with levels BS, BS2, AB, and AB2 (in this order) based on `degree`.\nDo this by adding on to your pipeline from earlier.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstatsci |>\n  pivot_longer(\n    cols = -degree,\n    names_to = \"year\",\n    names_transform = as.numeric,\n    values_to = \"n\"\n  ) |>\n  mutate(n = if_else(is.na(n), 0, n)) |>\n  # ???\n```\n:::\n\n\n## Finish {.smaller .scrollable}\n\n::: task\nNow that you have your data pivoting and cleaning pipeline figured out, save the resulting data frame as `statsci_longer`.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstatsci |>\n  pivot_longer(\n    cols = -degree,\n    names_to = \"year\",\n    names_transform = as.numeric,\n    values_to = \"n\"\n  ) |>\n  mutate(n = if_else(is.na(n), 0, n)) |>\n  separate(degree, sep = \" \\\\(\", into = c(\"major\", \"degree_type\")) |>\n  mutate(\n    degree_type = str_remove(degree_type, \"\\\\)\"),\n    degree_type = fct_relevel(degree_type, \"BS\", \"BS2\", \"AB\", \"AB2\")\n  )\n```\n:::\n\n\n# Application exercise\n\n## ae\\-05\\-majors\\-tidy {.smaller}\n\n::: appex\n-   Go to your ae project in RStudio.\n\n-   If you haven't yet done so, make sure all of your changes up to this point are committed and pushed, i.e., there's nothing left in your Git pane.\n\n-   If you haven't yet done so, click Pull to get today's application exercise file: *ae\\-05\\-majors\\-tidy\\.qmd*.\n\n-   Work through the application exercise in class, and render, commit, and push your edits by the end of class.\n:::\n\n## Recap: pivoting {.smaller}\n\n::: incremental\n-   Data sets can't be labeled as *wide* or *long* but they can be made *wider* or *longer* for a certain analysis that requires a certain format\n-   When pivoting longer, variable names that turn into values are characters by default. If you need them to be in another format, you need to explicitly make that transformation, which you can do so within the `pivot_longer()` function.\n-   You can tweak a plot forever, but at some point the tweaks are likely not very productive. However, you should always be critical of defaults (however pretty they might be) and see if you can improve the plot to better portray your data / results / what you want to communicate.\n:::\n",
>>>>>>> 7e1678c477da4d094373d1a02a4b3fbfa78dca28
    "supporting": [
      "07-tidying-data_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}