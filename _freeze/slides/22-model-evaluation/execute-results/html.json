{
  "hash": "ca5769a99b5fabd6ee627aac9588ffa5",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Evaluating models\"\nsubtitle: \"Lecture 22\"\ndate: \"2025-11-13\"\nformat: \n  revealjs: \n    output-file: 21-evaluating-models-slides.html\n    footer: \"[ðŸ”— sta199-f25.github.io](https://sta199-f25.github.io/)\"\n    theme: slides.scss\n    transition: fade\n    slide-number: true\n    logo: images/logo.png\n    pdf-separate-fragments: true\n    toc: false\n  html: \n    code-link: true\nfilters: \n  - ../remove-fmt-skip.lua\neditor_options: \n  chunk_output_type: console\n---\n\n\n\n# Warm-up\n\n## While you wait: Participate ðŸ“±ðŸ’» {.xsmall}\n\n::: columns\n\n::: {.column width=\"70%\"}\n\n::: wooclap\n\nWhat is sensitivity also known as?\n\n::: wooclap-choices\n- True positive rate\n- True negative rate\n- False positive rate\n- False negative rate\n- Recall\n:::\n\n:::\n\n:::\n\n::: {.column width=\"30%\"}\n![](images/wooclap-qr.png){width=\"200\" fig-align=\"center\"}\n\n::: small\nScan the QR code or go to [app.wooclap.com/sta199](https://app.wooclap.com/sta199). Log in with your Duke NetID.\n:::\n\n:::\n\n:::\n\n## Announcements\n\n- Projects due tonight, peer evals diue tpmorrow night\n\n- Practice Exam 2 is posted on the course website\n\n- Reply to post on Ed about requests for topics / concepts for exam review [[thread]](https://edstem.org/us/courses/80616/discussion/7304129)\n\n## From last class: Participate ðŸ“±ðŸ’» {.xsmall}\n\n::: columns\n\n::: {.column width=\"70%\"}\n\n::: wooclap\n\nWhich of the following best describes the area annotated on the ROC curve?\n\n![](images/22/roc-curve-annotated-question.png){width=500}\n\n::: wooclap-choices\n- Where all positives classified as positive, all negatives classified as negative\n- Where true positive rate = false positive rate\n- Where all positives classified as negative, all negatives classified as positive\n:::\n\n:::\n\n:::\n\n::: {.column width=\"30%\"}\n![](images/wooclap-qr.png){width=\"200\" fig-align=\"center\"}\n\n::: small\nScan the QR code or go to [app.wooclap.com/sta199](https://app.wooclap.com/sta199). Log in with your Duke NetID.\n:::\n\n:::\n\n:::\n\n## ROC curve {.smaller}\n\n::: task\nWhich corner of the plot indicates the best model performance?\n:::\n\n![](images/22/roc-curve-annotated.png)\n\n# Next steps\n\n## Next steps {.smaller}\n\n::: incremental\n-   Fit models on training data\n\n-   Make predictions on testing data\n\n-   Evaluate predictions on testing data:\n\n    -   Linear models: R-squared, adjusted R-squared, RMSE (root mean squared error), etc.\n    -   Logistic models: False negative and positive rates, AUC (area under the curve), etc.\n\n-   Make decisions based on model predictive performance, validity across various testing/training splits (aka \"cross validation\"), explainability\n:::\n\n. . .\n\n::: callout-note\nWe will only learn about a subset of these in this course, but you can go further into these ideas in STA 210 or STA 221 as well as in various machine learning courses.\n:::\n\n## ae\\-14\\-chicago\\-taxi\\-classification {.smaller}\n\n::: appex\n-   Go to your ae project in RStudio.\n\n-   If you haven't yet done so, make sure all of your changes up to this point are committed and pushed, i.e., there's nothing left in your Git pane.\n\n-   If you haven't yet done so, click Pull to get today's application exercise file: *ae\\-14\\-chicago\\-taxi\\-classification\\.qmd*.\n\n-   Work through the application exercise in class, and render, commit, and push your edits.\n:::\n\n## Recap {.smaller}\n\n::: incremental\n- Split data into training and testing sets (generally 75/25)\n\n- Fit models on training data and reduce to a few candidate models\n\n- Make predictions on testing data\n\n- Evaluate predictions on testing data using appropriate predictive performance metrics\n  - Linear models: Adjusted R-squared, AIC, etc.\n  - Logistic models: False negative and positive rates, AUC (area under the curve), etc.\n\n- Don't forget to also consider explainability and domain knowledge when selecting a final model\n\n- In a future machine learning course: Cross-validation (partitioning training data into training and validation sets and repeating this many times to evaluate model predictive performance before using the testing data), feature engineering,  hyperparameter tuning, more complex models (random forests, gradient boosting machines, neural networks, etc.)\n:::\n\n# [Time permitting] The ðŸ˜ in the room: Chat GPT (and friends)\n\n## Take a pulse\n\n::: question\nHow are you using Chat GPT or similar AI tools for this class?\n:::\n\n## Example 1 - Similar to Lab 4 {.smaller .scrollable}\n\n::: question\nSurveyUSA polled 900 NC adults between September 4-7, 2024.\nOf the 900 NC adults, 771 were identified by SurveyUSA as being registered to vote.\nThe following question was asked to these 771 adults: \"Should the use of marijuana for medical use remain against the law in North Carolina? Or be legalized?\"\n\nOf the 771 responses, 391 were between the ages of 18-49.\nOf the individuals that are between 18-49, 59 individuals responded that they think medical marijuana should remain against the law, 292 said it should be made legal, and the remainder were not sure.\nOf the individuals that are 50+, 67 individuals responded that they think medical marijuana should remain against the law, 245 said it should be made legal, and the remainder were not sure.\n\nCalculate the proportions of 18-49 year olds and 50+ year-olds in this sample.\nmake sure the result is an ungrouped data frame with a column for relevant counts, a column for relevant proportions, and a column for the groups youâ€™re interested in.\n:::\n\n## Chat GPT - Take 1 prompt {.smaller .scrollable}\n\n::: question\nWhat is wrong with this prompt?\nHow would you correct it?\n:::\n\n> SurveyUSA polled 900 NC adults between September 4-7, 2024.\n> Of the 900 NC adults, 771 were identified by SurveyUSA as being registered to vote.\n> The following question was asked to these 771 adults: \"Should the use of marijuana for medical use remain against the law in North Carolina? Or be legalized?\"\n\n> Of the 771 responses, 391 were between the ages of 18-49.\n> Of the individuals that are between 18-49, 59 individuals responded that they think medical marijuana should remain against the law, 292 said it should be made legal, and the remainder were not sure.\n> Of the individuals that are 50+, 67 individuals responded that they think medical marijuana should remain against the law, 245 said it should be made legal, and the remainder were not sure.\n\n> Calculate the proportions of 18-49 year olds and 50+ year-olds in this sample.\n> Make sure the result is an ungrouped data frame with a column for relevant counts, a column for relevant proportions, and a column for the groups youâ€™re interested in.\n\n## Chat GPT - Take 1 response {.smaller .scrollable}\n\n::: question\nIdentify at least one mistake or code smell/style issue with the code below.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n\n# Given data\ntotal_registered <- 771\n\n# Responses by age group\nresponses <- tribble(\n  ~age_group , ~against , ~legalize , ~not_sure                ,\n  \"18-49\"    ,       59 ,       292 , 391 - (59 + 292)         ,\n  \"50+\"      ,       67 ,       245 , (771 - 391) - (67 + 245)\n)\n\n# Calculate total per group\nresponses <- responses %>%\n  mutate(total = against + legalize + not_sure)\n\n# Then calculate proportions of each age group in the total sample\nage_props <- responses %>%\n  summarise(\n    total_18_49 = sum(total[age_group == \"18-49\"]),\n    total_50_plus = sum(total[age_group == \"50+\"])\n  ) %>%\n  pivot_longer(everything(), names_to = \"age_group\", values_to = \"count\") %>%\n  mutate(\n    age_group = recode(\n      age_group,\n      \"total_18_49\" = \"18-49\",\n      \"total_50_plus\" = \"50+\"\n    ),\n    proportion = count / total_registered\n  )\n\n# Show both tables\nlist(\n  responses_by_age = responses,\n  proportions_by_age = age_props\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$responses_by_age\n# A tibble: 2 Ã— 5\n  age_group against legalize not_sure total\n  <chr>       <dbl>    <dbl>    <dbl> <dbl>\n1 18-49          59      292       40   391\n2 50+            67      245       68   380\n\n$proportions_by_age\n# A tibble: 2 Ã— 3\n  age_group count proportion\n  <chr>     <dbl>      <dbl>\n1 18-49       391      0.507\n2 50+         380      0.493\n```\n\n\n:::\n:::\n\n\n## Let's follow along with Chat GPT...\n\n<https://chatgpt.com/share/e/690a259e-d0ac-8005-a3d8-0c1f80d22e7c>\n\n## Example 2 {.smaller}\n\n::: question\nEach CSI franchise includes a number of series, each with the character string `\"CSI\"` (in capital letters) in their title.\nUsing this information, create a new data frame called `csi` that only has titles from the CSI-verse and all of the columns from `tv` for these titles.\nThen, display the first 10 rows of `csi`.\n**Note:** The titles and seasons included in the dataset may not be all CSI titles and titles that have ever aired.\n:::\n\n## Chat GPT - Take 1 prompt\n\n> Each CSI franchise includes a number of series, each with the character string `\"CSI\"` (in capital letters) in their title.\n> Using this information, create a new data frame called `csi` that only has titles from the CSI-verse and all of the columns from `tv` for these titles.\n> Then, display the first 10 rows of `csi`.\n> **Note:** The titles and seasons included in the dataset may not be all CSI titles and titles that have ever aired.\n\n## Chat GPT - Take 1 response {.xsmall}\n\n> Here's a short, safe solution. It keeps all columns from tv, selects only rows whose title contains the exact uppercase string \"CSI\", stores that in csi, then prints the first 10 rows.\n>\n>``` r\n> # Base R solution (case-sensitive match for \"CSI\")\n> csi <- tv[grepl(\"CSI\", tv$title, fixed = TRUE), ]\n>\n># Show the first 10 rows\n>head(csi, 10)\n>```\n>\n>If you prefer dplyr:\n>``` r\n>library(dplyr)\n>\n>csi <- tv %>%\n>  filter(grepl(\"CSI\", title, fixed = TRUE))\n>\n>csi %>% slice_head(n = 10)\n>```\n>\n>Notes:\n>The code above searches for the exact uppercase substring `\"CSI\"` (per your instructions).\n>If you want a case-insensitive match (e.g., to also catch `\"csi\"`), use `grepl(\"CSI\", tv$title, ignore.case = TRUE)` or `fixed = FALSE` with `ignore.case = TRUE`.\n\n## Chat GPT - Take 1 code {.xsmall}\n\n::: question\nWhat is wrong with the following code?\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntv <- read_csv(\"data/tv.csv\")\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\n\ncsi <- tv %>%\n  filter(grepl(\"CSI\", title, fixed = TRUE))\n\ncsi %>% slice_head(n = 10)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 Ã— 9\n   season title     year month   day av_rating genre_1 genre_2 genre_3\n    <dbl> <chr>    <dbl> <dbl> <dbl>     <dbl> <chr>   <chr>   <chr>  \n 1      1 CSI: Crâ€¦  2001     1    20      8.32 Crime   Drama   Mystery\n 2      2 CSI: Crâ€¦  2002     1    10      8.26 Crime   Drama   Mystery\n 3      3 CSI: Crâ€¦  2003     1    15      8.30 Crime   Drama   Mystery\n 4      4 CSI: Crâ€¦  2004     1    18      8.33 Crime   Drama   Mystery\n 5      5 CSI: Crâ€¦  2005     1    24      8.38 Crime   Drama   Mystery\n 6      6 CSI: Crâ€¦  2006     1    16      8.21 Crime   Drama   Mystery\n 7      7 CSI: Crâ€¦  2007     1    14      8.43 Crime   Drama   Mystery\n 8      8 CSI: Crâ€¦  2008     1     7      8.07 Crime   Drama   Mystery\n 9      9 CSI: Crâ€¦  2009     1    27      7.80 Crime   Drama   Mystery\n10     10 CSI: Crâ€¦  2010     1    23      7.69 Crime   Drama   Mystery\n```\n\n\n:::\n:::\n\n\n## Let's follow along with Chat GPT...\n\n<https://chatgpt.com/share/e/690a2790-6a9c-8005-b6db-ca8e37607244>\n\n## Guidelines and best practices for using Chat GPT {.smaller}\n\n::: incremental\n-   Do [**not**]{.underline} just copy-paste the prompt â€“ for appropriate academic conduct, for your own learning, and for getting to better results faster\n-   Engineer the prompt until the response starts to look like code you're learning in the course\n-   If the response is not correct, ask for a correction\n-   If the response doesn't follow the guidelines, ask for a correction\n-   When you ask for a correction, be ready for it to \"correct\" (i.e., change) more than you asked for\n-   Do not just copy-paste code from Chat GPT responses, run it line-by-line and edit as needed -- Chat GPT does not execute R code so there's no guarantee any of the code it gives you works\n-   Watch out for clear mistakes in the response: do not keep loading packages that are already loaded, use the base pipe `|>`, use the tidyverse style, do not use unnecessary `print()` statements, be critical of code smell, etc.\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}