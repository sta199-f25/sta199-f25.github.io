{
  "hash": "ab52b1e6968d8ed38fa028dcba6afe66",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Grammar of data transformation\"\nsubtitle: \"Lecture 4\"\ndate: \"2025-09-04\"\nformat: \n  revealjs: \n    output-file: 04-grammar-of-data-transformation-slides.html\n    footer: \"[🔗 sta199-f25.github.io](https://sta199-f25.github.io/)\"\n    theme: slides.scss\n    transition: fade\n    slide-number: true\n    logo: images/logo.png\n    toc: false\n  html: \n    code-link: true\n---\n\n\n\n# Warm-up\n\n## While you wait: Participate 📱💻 {.smaller}\n\n::: {.columns}\n\n::: {.column width=\"75%\"}\n\n::: wooclap\nWhich of the following is **true** about the code below?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mtcars, _[blank]_(x = wt, y = mpg)) +\n  geom_point() +\n  geom_smooth()\n```\n:::\n\n\n::: small\n- `mtcars` is the name of the variable being plotted on the x-axis\n- The function that goes in the blank is `map()`\n- The data are being visualized with a scatterplot and a smooth line\n- Some points on the plot will be colored differently than others\n:::\n\n:::\n\n:::\n\n::: {.column width=\"25%\"}\n\n![](images/wooclap-qr.png){width=\"200\" fig-align=\"center\"}\n\n::: small\nScan the QR code or go to [app.wooclap.com/sta199](https://app.wooclap.com/sta199). Log in with your Duke NetID.\n:::\n\n\n:::\n\n::: \n\n## Announcements {.smaller}\n\n-   Continue to respond to Wooclap questions during class and remember that attendance and participation are part of your grade -- if we haven't gotten any responses from you yet, and you didn't just add the class, you've already heard from us!\n\n-   Lab 1 is on Monday, HW 1 is due next Sunday.\n\n# From last time\n\n## Bechdel test {.smaller}\n\n::: {.columns}\n\n::: {.column width=\"70%\"}\nThe **Bechdel test** (or the **Bechdel-Wallace test**), named after cartoonist Alison Bechdel,\n\n> is a measure of the representation of women in film and other fiction. The test asks whether a work features at least two women who have a conversation about something other than a man. Some versions of the test also require that those two women have names.\n:::\n\n::: {.column width=\"30%\"}\n\n![](images/04/alison-bechdel.png)\n\n:::\n\n::: \n\n::: aside\nSource: [Wikipedia](https://en.wikipedia.org/wiki/Bechdel_test)\n:::\n\n## The origin of the Bechdel test \n\n::: {.columns}\n\n::: {.column width=\"70%\"}\n\n![](images/04/bechdel-test.png)\n\n*Dykes to Watch Out For* - 1985\n\n:::\n\n::: {.column width=\"30%\"}\n\nFilm passes if…\n\n1. two female characters;\n2. talk to each other;\n3. about something besides a man.\n\n:::\n\n:::\n\n## How did some of my favorite movies do? {.smaller}\n\n::: incremental\n- The Big Lebowski ❌\n- In the Mood for Love ✅\n- Trainspotting ❌\n- Love Actually ✅\n- Eternal Sunshine of the Spotless Mind ❌\n- Before Sunrise ❌\n- When Harry Met Sally ✅\n- Garden State ✅\n- Empire Records ✅\n- Amélie ✅\n:::\n\n## Data story {.smaller}\n\n![](images/04/bechdel-538.png)\n\n> We did a statistical analysis of films to test two claims: first, that films that pass the Bechdel test — featuring women in stronger roles — see a lower return on investment, and second, that they see lower gross profits. We found no evidence to support either claim.\n\n::: aside\nSource: [The Dollar-And-Cents Case Against Hollywood’s Exclusion of Women](https://fivethirtyeight.com/features/the-dollar-and-cents-case-against-hollywoods-exclusion-of-women/), by Walt Hickey, FiveThirtyEight, April 1, 2014.\n:::\n\n## `ae-02-bechdel-dataviz` {.smaller}\n\n::: appex\n-   Go to your `ae` project in RStudio.\n-   Make sure all of your changes up to this point are committed and pushed, i.e., there's nothing left in your Git pane.\n-   If you haven't done so during the last class, click **Pull** to get today's application exercise file.\n-   Work through the application exercise in class, and **render, commit, and push** your edits by the end of class.\n:::\n\n## Recap {.smaller}\n\n-   Construct plots with `ggplot()`.\n-   Layers of ggplots are separated by `+`s.\n-   The formula is (almost) always as follows:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(DATA, aes(x = X-VAR, y = Y-VAR, ...)) +\n  geom_XXX()\n```\n:::\n\n\n## Recap: Code cells (aka code chunks) {.smaller}\n\n![](images/04/code-cell.png)\n\n-   Cell `label`s are helpful for describing what the code is doing, for jumping between code cells in the editor, and for troubleshooting\n\n-   `message: false` hides any messages emitted by the code in your rendered document\n\n# Data transformation\n\n## A quick reminder {.smaller}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbechdel |> # <1>\n  filter(roi > 400) |> # <2>\n  select(title, roi, budget_2013, gross_2013, year, clean_test) # <3>\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 6\n  title                    roi budget_2013 gross_2013  year clean_test\n  <chr>                  <dbl>       <dbl>      <dbl> <dbl> <chr>     \n1 Paranormal Activity     671.      505595  339424558  2007 dubious   \n2 The Blair Witch Proje…  648.      839077  543776715  1999 ok        \n3 El Mariachi             583.       11622    6778946  1992 nowomen   \n```\n\n\n:::\n:::\n\n\n1.  Start with the `bechdel` data frame\n2.  Filter for movies with `roi` greater than 400 (gross is more than 400 times budget)\n3.  Select the columns `title`, `roi`, `budget_2013`, `gross_2013`, `year`, and `clean_test`\n\n## Participate 📱💻 {.smaller}\n\n::: {.columns}\n\n::: {.column width=\"75%\"}\n\n::: wooclap\nIn data transformation with the pipe operator `|>`, what does the operator do?\n\n::: small\n- It ends a pipeline and prints the result.\n- It joins two data frames together.\n- It passes the output from the previous command into the first argument of the function in the next command.\n- It is equivalent to the \"or\" operator.\n:::\n\n:::\n\n:::\n\n::: {.column width=\"25%\"}\n\n![](images/wooclap-qr.png){width=\"200\" fig-align=\"center\"}\n\n::: small\nScan the QR code or go to [app.wooclap.com/sta199](https://app.wooclap.com/sta199). Log in with your Duke NetID.\n:::\n\n\n:::\n\n::: \n\n## The pipe `|>` {.smaller}\n\nThe pipe operator passes what comes before it into the function that comes after it as the first argument in that function.\n\n::: columns\n::: {.column .fragment width=\"55%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\nsum(1, 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 3\n```\n\n\n:::\n:::\n\n:::\n\n::: {.column .fragment width=\"45%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\n1 |> \n  sum(2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 3\n```\n\n\n:::\n:::\n\n:::\n:::\n\n<br>\n\n::: columns\n::: {.column .fragment width=\"55%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\nselect(filter(bechdel, roi > 400), title)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 1\n  title                  \n  <chr>                  \n1 Paranormal Activity    \n2 The Blair Witch Project\n3 El Mariachi            \n```\n\n\n:::\n:::\n\n:::\n\n::: {.column .fragment width=\"45%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\nbechdel |>\n  filter(roi > 400) |>\n  select(title)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 1\n  title                  \n  <chr>                  \n1 Paranormal Activity    \n2 The Blair Witch Project\n3 El Mariachi            \n```\n\n\n:::\n:::\n\n:::\n:::\n\n## Code style tip {{< fa lightbulb >}} {.smaller}\n\n-   In data transformation pipelines, always use a\n    -   space before `|>`\n    -   line break after `|>`\n    -   indent the next line of code\n\n. . .\n\n-   In data visualization layers, always use a\n    -   space before `+`\n    -   line break after `+`\n    -   indent the next line of code\n\n## The pipe, in action {.smaller}\n\n::: task\nFind movies that pass the Bechdel test and display their titles and ROIs in descending order of ROI.\n:::\n\n. . .\n\nStart with the `bechdel` data frame:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbechdel\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1,615 × 7\n   title          year gross_2013 budget_2013    roi binary clean_test\n   <chr>         <dbl>      <dbl>       <dbl>  <dbl> <chr>  <chr>     \n 1 21 & Over      2013   67878146    13000000  5.22  FAIL   notalk    \n 2 Dredd 3D       2012   55078343    45658735  1.21  PASS   ok        \n 3 12 Years a S…  2013  211714070    20000000 10.6   FAIL   notalk    \n 4 2 Guns         2013  208105475    61000000  3.41  FAIL   notalk    \n 5 42             2013  190040426    40000000  4.75  FAIL   men       \n 6 47 Ronin       2013  184166317   225000000  0.819 FAIL   men       \n 7 A Good Day t…  2013  371598396    92000000  4.04  FAIL   notalk    \n 8 About Time     2013  102648667    12000000  8.55  PASS   ok        \n 9 Admission      2013   36014634    13000000  2.77  PASS   ok        \n10 After Earth    2013  304895295   130000000  2.35  FAIL   notalk    \n# ℹ 1,605 more rows\n```\n\n\n:::\n:::\n\n\n## The pipe, in action {.smaller}\n\n::: task\nFind movies that pass the Bechdel test and display their titles and ROIs in descending order of ROI.\n:::\n\nFilter for rows where `binary` is equal to `\"PASS\"`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbechdel |>\n  filter(binary == \"PASS\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 753 × 7\n   title           year gross_2013 budget_2013   roi binary clean_test\n   <chr>          <dbl>      <dbl>       <dbl> <dbl> <chr>  <chr>     \n 1 Dredd 3D        2012   55078343    45658735  1.21 PASS   ok        \n 2 About Time      2013  102648667    12000000  8.55 PASS   ok        \n 3 Admission       2013   36014634    13000000  2.77 PASS   ok        \n 4 American Hust…  2013  397915817    40000000  9.95 PASS   ok        \n 5 August: Osage…  2013   87609748    25000000  3.50 PASS   ok        \n 6 Beautiful Cre…  2013   75392809    50000000  1.51 PASS   ok        \n 7 Blue Jasmine    2013  101793664    18000000  5.66 PASS   ok        \n 8 Carrie          2013  120268278    30000000  4.01 PASS   ok        \n 9 Despicable Me…  2013 1338831390    76000000 17.6  PASS   ok        \n10 Elysium         2013  379242208   120000000  3.16 PASS   ok        \n# ℹ 743 more rows\n```\n\n\n:::\n:::\n\n\n## The pipe, in action {.smaller}\n\n::: task\nFind movies that pass the Bechdel test and display their titles and ROIs in descending order of ROI.\n:::\n\nArrange the rows in `desc`ending order of `roi`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbechdel |>\n  filter(binary == \"PASS\") |>\n  arrange(desc(roi))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 753 × 7\n   title           year gross_2013 budget_2013   roi binary clean_test\n   <chr>          <dbl>      <dbl>       <dbl> <dbl> <chr>  <chr>     \n 1 The Blair Wit…  1999  543776715      839077 648.  PASS   ok        \n 2 The Devil Ins…  2012  157289709     1014639 155.  PASS   ok        \n 3 My Big Fat Gr…  2002  768922942     6475896 119.  PASS   ok        \n 4 Chasing Amy     1997   39417963      362810 109.  PASS   ok        \n 5 Slacker         1991    4200140       39349 107.  PASS   ok        \n 6 Insidious       2010  164379554     1602348 103.  PASS   ok        \n 7 Paranormal Ac…  2010  280159759     3204696  87.4 PASS   ok        \n 8 Paranormal Ac…  2011  322170936     5178454  62.2 PASS   ok        \n 9 The Last Exor…  2010  118787648     1922817  61.8 PASS   ok        \n10 Cinderella      1997  246710482     4208591  58.6 PASS   ok        \n# ℹ 743 more rows\n```\n\n\n:::\n:::\n\n\n## The pipe, in action {.smaller}\n\n::: task\nFind movies that pass the Bechdel test and display their titles and ROIs in descending order of ROI.\n:::\n\nSelect columns `title` and `roi`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbechdel |>\n  filter(binary == \"PASS\") |>\n  arrange(desc(roi)) |>\n  select(title, roi)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 753 × 2\n   title                      roi\n   <chr>                    <dbl>\n 1 The Blair Witch Project  648. \n 2 The Devil Inside         155. \n 3 My Big Fat Greek Wedding 119. \n 4 Chasing Amy              109. \n 5 Slacker                  107. \n 6 Insidious                103. \n 7 Paranormal Activity 2     87.4\n 8 Paranormal Activity 3     62.2\n 9 The Last Exorcism         61.8\n10 Cinderella                58.6\n# ℹ 743 more rows\n```\n\n\n:::\n:::\n\n\n## In this class, you will... {.smaller}\n\n::: columns\n::: {.column width=\"50%\"}\nBuild cakes (`ggplot`) ![](images/04/cake.png)\n:::\n\n::: {.column width=\"50%\"}\nStack dolls (pipe `|>`) ![](images/04/matryoshka.png)\n:::\n:::\n\nMaster these constructs, and everything will be A-Ok!\n\n::: aside\nSource: [Cake by Anirban Sengupta on Unsplash](https://unsplash.com/photos/white-pink-and-yellow-cake-GQvNc4bDRYw) and [Matryoshka dolls by Julia Kadel  on Unsplash](https://unsplash.com/photos/a-group-of-russian-nesting-dolls-sitting-on-a-table-YmULswIbc3I).\n:::      \n\n# Looking forward: Describing distributions and relationships\n\n## Participate 📱💻 {.smaller}\n\n::: {.columns}\n\n::: {.column width=\"75%\"}\n\n::: wooclap\nWhich type of visualization is useful for comparing distributions across groups?\n\n- Histogram\n- Line plot\n- Scatterplot\n- Side-by-side boxplots\n:::\n\n:::\n\n::: {.column width=\"25%\"}\n\n![](images/wooclap-qr.png){width=\"200\" fig-align=\"center\"}\n\n::: small\nScan the QR code or go to [app.wooclap.com/sta199](https://app.wooclap.com/sta199). Log in with your Duke NetID.\n:::\n\n\n:::\n\n::: \n\n## One numerical variable {.smaller}\n\n::: columns\n::: {.column width=\"50%\"}\n\n::: {.cell}\n::: {.cell-output-display}\n![](04-grammar-of-data-transformation_files/figure-revealjs/unnamed-chunk-12-1.png){width=960}\n:::\n:::\n\n:::\n\n::: {.column width=\"50%\"}\n\n::: {.cell}\n::: {.cell-output-display}\n![](04-grammar-of-data-transformation_files/figure-revealjs/unnamed-chunk-13-1.png){width=960}\n:::\n:::\n\n:::\n:::\n\n- **Center**: What is the \"typical\" value (mean, median, mode) the data are concentrating around?\n- **Spread**: How concentrated are the data around a typical value?\n- **Shape**: Does the distribution have one peak, or many? is it symmetric or skewed?\n\n## Shape vs. center\n\n![](images/04/mean-median-mode.png)\n\n## Histograms provide more detail...\n\n::: columns\n::: {.column width=\"50%\"}\n\n::: {.cell}\n::: {.cell-output-display}\n![](04-grammar-of-data-transformation_files/figure-revealjs/unnamed-chunk-14-1.png){width=960}\n:::\n:::\n\n:::\n\n::: {.column width=\"50%\"}\n\n::: {.cell}\n::: {.cell-output-display}\n![](04-grammar-of-data-transformation_files/figure-revealjs/unnamed-chunk-15-1.png){width=960}\n:::\n:::\n\n:::\n:::\n\n\n## ...but boxplots are nice for side-by-side comparisons\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](04-grammar-of-data-transformation_files/figure-revealjs/unnamed-chunk-16-1.png){width=960}\n:::\n:::\n\n\n## Talking about two numerical variables\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](04-grammar-of-data-transformation_files/figure-revealjs/unnamed-chunk-17-1.png){width=864}\n:::\n:::\n\n\n- **Direction**: Positive or negative\n- **Shape**: Linear or nonlinear\n- **Strength**: How close are points to the \"trend\"\n\n## Strength and direction of linear relationships\n\n![](images/04/corr.png)\n\n## Nonlinear relationships\n\n![](images/04/un-data-viz.png)\n",
    "supporting": [
      "04-grammar-of-data-transformation_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}