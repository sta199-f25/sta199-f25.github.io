{
  "hash": "dcc6a21f5a00bb110d35a7d839d6df50",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Spending your data\"\nsubtitle: \"Lecture 21\"\ndate: \"2025-11-11\"\nformat: \n  revealjs: \n    output-file: 21-spending-your-data-slides.html\n    footer: \"[üîó sta199-f25.github.io](https://sta199-f25.github.io/)\"\n    theme: slides.scss\n    transition: fade\n    slide-number: true\n    logo: images/logo.png\n    pdf-separate-fragments: true\n    toc: false\n  html: \n    code-link: true\nfilters: \n  - ../remove-fmt-skip.lua\neditor_options: \n  chunk_output_type: console\n---\n\n\n\n# Warm-up\n\n## Announcements {.smaller}\n\n-   Project write-ups due Thursday at 11:59pm\n\n-   Peer evaluations due Friday at 11:59pm\n\n# Setup\n\n## Packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse) # data wrangling and visualization\nlibrary(tidymodels) # modeling\n```\n:::\n\n\n## Data\n\n-   Taxi trips in Chicago, IL in 2022\n\n-   Data from [Chicago Data Portal](https://data.cityofchicago.org/Transportation/Taxi-Trips/wrvz-psew)\n\n## Data: `chicago_taxi` {.smaller}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchicago_taxi <- read_csv(\"data/chicago-taxi.csv\")\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchicago_taxi\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4,000 √ó 7\n   tip   distance company                      local dow   month  hour\n   <chr>    <dbl> <chr>                        <chr> <chr> <chr> <dbl>\n 1 no        0.4  other                        yes   Fri   Mar      17\n 2 no        0.96 Taxicab Insurance Agency Llc no    Mon   Apr       8\n 3 no        1.07 Sun Taxi                     no    Fri   Feb      15\n 4 no        1.13 other                        no    Sat   Feb      14\n 5 no       10.8  Sun Taxi                     no    Sat   Apr      14\n 6 no        3.6  Chicago Independents         no    Wed   Mar      12\n 7 no        1.08 Flash Cab                    yes   Wed   Mar      13\n 8 no        0.85 Taxicab Insurance Agency Llc no    Tue   Mar       8\n 9 no       17.9  City Service                 no    Tue   Jan      20\n10 no        0    City Service                 yes   Sun   Apr      16\n# ‚Ñπ 3,990 more rows\n```\n\n\n:::\n:::\n\n\n## Data: `chicago_taxi` {.smaller}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(chicago_taxi)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 4,000\nColumns: 7\n$ tip      <chr> \"no\", \"no\", \"no\", \"no\", \"no\", \"no\", \"no\", \"no\", \"no‚Ä¶\n$ distance <dbl> 0.40, 0.96, 1.07, 1.13, 10.81, 3.60, 1.08, 0.85, 17‚Ä¶\n$ company  <chr> \"other\", \"Taxicab Insurance Agency Llc\", \"Sun Taxi\"‚Ä¶\n$ local    <chr> \"yes\", \"no\", \"no\", \"no\", \"no\", \"no\", \"yes\", \"no\", \"‚Ä¶\n$ dow      <chr> \"Fri\", \"Mon\", \"Fri\", \"Sat\", \"Sat\", \"Wed\", \"Wed\", \"T‚Ä¶\n$ month    <chr> \"Mar\", \"Apr\", \"Feb\", \"Feb\", \"Apr\", \"Mar\", \"Mar\", \"M‚Ä¶\n$ hour     <dbl> 17, 8, 15, 14, 14, 12, 13, 8, 20, 16, 20, 8, 15, 15‚Ä¶\n```\n\n\n:::\n:::\n\n\n## Data prep\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchicago_taxi <- chicago_taxi |>\n  mutate(\n    tip = fct_relevel(tip, \"no\", \"yes\"),\n    local = fct_relevel(local, \"no\", \"yes\"),\n    dow = fct_relevel(dow, \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"),\n    month = fct_relevel(month, \"Jan\", \"Feb\", \"Mar\", \"Apr\")\n  )\n```\n:::\n\n\n## Outcome and predictors {.smaller}\n\n- Outcome - `tip`: Whether rider left a tip -- a factor w/ levels \"yes\" and \"no\"\n- (Potential) predictors:\n  - Numerical:\n    - `distance`: The trip distance, in odometer miles.\n    - `hour`: The hour of the day in which the trip began.\n  - Categorical:\n    - `company`: The taxi company -- companies that occurred few times were binned as \"other\".\n    - `local`: Whether the trip started in the same community area as it began.\n    - `dow`: The day of the week in which the trip began.\n    - `month`: The month in which the trip began.\n\n## Should we include a predictor?\n\nTo determine whether we should include a predictor in a model, we should start by asking:\n\n::: incremental\n-   Is it ethical to use this variable?\n    (Or even legal?)\n\n-   Will this variable be available at prediction time?\n\n-   Does this variable contribute to explainability?\n:::\n\n# Data splitting and spending\n\n## We've been cheating!\n\n::: incremental\n-   So far, we've been using all the data we have for building models.\n    In predictive contexts, this would be considered *cheating*.\n\n-   Evaluating model performance for predicting outcomes that were used when building the models is like evaluating your learning with questions whose answers you've already seen.\n:::\n\n## Spending your data {.smaller}\n\nFor predictive models (used primarily in machine learning), we typically split data into training and test sets:\n\n![](images/21/test-train-split-1.svg){fig-align=\"center\"}\n\n-   The **training set** is used to estimate model parameters.\n\n-   The **test set** is used to find an independent assessment of model performance.\n\n. . .\n\n::: callout-warning\nDo not use, or even peek at, the test set during training.\n:::\n\n## How much to spend?\n\n::: incremental\n-   The more data we spend (use in training), the better estimates we‚Äôll get.\n\n-   Spending too much data in training prevents us from computing a good assessment of predictive performance.\n\n-   Spending too much data in testing prevents us from computing a good estimate of model parameters.\n:::\n\n## The initial split\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(20251111)\nchicago_taxi_split <- initial_split(chicago_taxi)\nchicago_taxi_split\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n<Training/Testing/Total>\n<3000/1000/4000>\n```\n\n\n:::\n:::\n\n\n## Setting a seed {.smaller}\n\n::: task\nWhat does `set.seed()` do?\n:::\n\n::: incremental\n-   To create that split of the data, R generates ‚Äúpseudo-random‚Äù numbers: while they are made to behave like random numbers, their generation is deterministic given a ‚Äúseed‚Äù.\n\n-   This allows us to reproduce results by setting that seed.\n\n-   Which seed you pick doesn‚Äôt matter, as long as you don‚Äôt try a bunch of seeds and pick the one that gives you the best performance.\n:::\n\n## Accessing the data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchicago_taxi_train <- training(chicago_taxi_split)\nchicago_taxi_test <- testing(chicago_taxi_split)\n```\n:::\n\n\n## The training set {.smaller}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchicago_taxi_train\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3,000 √ó 7\n   tip   distance company                      local dow   month  hour\n   <fct>    <dbl> <chr>                        <fct> <fct> <fct> <dbl>\n 1 no         7.9 Taxi Affiliation Services    no    Sat   Apr      17\n 2 yes        0   Taxi Affiliation Services    yes   Mon   Jan       8\n 3 yes       17.5 other                        no    Thu   Jan      17\n 4 no         4.7 Taxi Affiliation Services    no    Fri   Jan       9\n 5 no        18.6 Taxicab Insurance Agency Llc no    Fri   Feb      15\n 6 yes        1.3 Taxi Affiliation Services    no    Thu   Jan      17\n 7 no        17.6 City Service                 no    Wed   Feb      19\n 8 yes       12.1 other                        no    Thu   Apr      13\n 9 no         0.4 other                        yes   Fri   Mar      17\n10 yes        2.2 other                        no    Wed   Apr      10\n# ‚Ñπ 2,990 more rows\n```\n\n\n:::\n:::\n\n\n## The testing data\n\n. . .\n\n::: huge\nüôà\n:::\n\n# Exploratory data analysis\n\n## Initial questions {.smaller}\n\n-   What‚Äôs the distribution of the outcome, `tip`?\n\n-   What‚Äôs the distribution of numeric variables like `distance` or `hour`?\n\n-   How does the distribution of `tip` differ across the categorical and numerical variables?\n\n. . .\n\n::: task\nWhich dataset should we use for the exploration?\nThe entire data `chicago_taxi`, the training data `chicago_taxi_train`, or the testing data `chicago_taxi_test`?\n:::\n\n## `tip`\n\nWhat‚Äôs the distribution of the outcome, `tip`?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchicago_taxi_train |>\n  count(tip) |>\n  mutate(prop = n / sum(n))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 √ó 3\n  tip       n  prop\n  <fct> <int> <dbl>\n1 no      572 0.191\n2 yes    2428 0.809\n```\n\n\n:::\n:::\n\n\n## `distance`\n\nWhat‚Äôs the distribution of `distance`?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(chicago_taxi_train, aes(x = distance)) +\n  geom_histogram(binwidth = 3)\n```\n\n::: {.cell-output-display}\n![](21-spending-your-data_files/figure-revealjs/unnamed-chunk-8-1.png){width=960}\n:::\n:::\n\n\n## `tip` and `distance` {.smaller}\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"|7\"}\nggplot(chicago_taxi_train, aes(x = distance, fill = tip, group = tip)) +\n  geom_histogram(binwidth = 3, show.legend = FALSE) +\n  scale_fill_manual(values = c(\"yes\" = \"darkolivegreen4\", \"no\" = \"darkgray\")) +\n  facet_wrap(~tip, ncol = 1, labeller = label_both, scales = \"free_y\")\n```\n\n::: {.cell-output-display}\n![](21-spending-your-data_files/figure-revealjs/unnamed-chunk-9-1.png){width=960}\n:::\n:::\n\n\n## `tip` and `hour` {.smaller}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(chicago_taxi_train, aes(x = hour, fill = tip, group = tip)) +\n  geom_histogram(binwidth = 1, show.legend = FALSE) +\n  scale_fill_manual(values = c(\"yes\" = \"darkolivegreen4\", \"no\" = \"darkgray\")) +\n  scale_x_continuous(breaks = seq(0, 18, by = 6)) +\n  facet_wrap(~tip, ncol = 1, labeller = label_both, scales = \"free_y\")\n```\n\n::: {.cell-output-display}\n![](21-spending-your-data_files/figure-revealjs/unnamed-chunk-10-1.png){width=960}\n:::\n:::\n\n\n## `tip` and `local` {.smaller}\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"|2\"}\nggplot(chicago_taxi_train, aes(x = local, fill = tip)) +\n  geom_bar(position = \"fill\", color = \"white\") +\n  scale_fill_manual(values = c(\"yes\" = \"darkolivegreen4\", \"no\" = \"darkgray\")) +\n  labs(y = \"Proportion\") +\n  theme(legend.position = \"top\")\n```\n\n::: {.cell-output-display}\n![](21-spending-your-data_files/figure-revealjs/unnamed-chunk-11-1.png){width=960}\n:::\n:::\n\n\n## `tip` and `dow` {.smaller}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(chicago_taxi_train, aes(x = dow, fill = tip)) +\n  geom_bar(position = \"fill\", color = \"white\") +\n  scale_fill_manual(values = c(\"yes\" = \"darkolivegreen4\", \"no\" = \"darkgray\")) +\n  labs(y = \"Proportion\", x = \"Day of week\") +\n  theme(legend.position = \"top\")\n```\n\n::: {.cell-output-display}\n![](21-spending-your-data_files/figure-revealjs/unnamed-chunk-12-1.png){width=960}\n:::\n:::\n\n\n# Terminology\n\n## False negative and positive\n\n-   **False negative rate** is the proportion of actual positives that were classified as negatives.\n\n-   **False positive rate** is the proportion of actual negatives that were classified as positives.\n\n## Sensitivity\n\n**Sensitivity** is the proportion of actual positives that were correctly classified as positive.\n\n-   Also known as **true positive rate** and **recall**\n\n-   Sensitivity = 1 ‚àí False negative rate\n\n-   Useful when false negatives are more \"expensive\" than false positives\n\n## Specificity\n\n**Specificity** is the proportion of actual negatives that were correctly classified as negative\n\n-   Also known as **true negative rate**\n\n-   Specificity = 1 ‚àí False positive rate\n\n## ROC curve\n\nThe **receiver operating characteristic (ROC) curve** allows to assess the model performance across a range of thresholds.\n\n![](images/21/roc-curve.png)\n\n## ROC curve {.smaller}\n\n::: task\nWhich corner of the plot indicates the best model performance?\n:::\n\n![](images/21/roc-curve-annotated.png)\n\n# Next steps\n\n## Next steps {.smaller}\n\n::: incremental\n-   Fit models on training data\n\n-   Make predictions on testing data\n\n-   Evaluate predictions on testing data:\n\n    -   Linear models: R-squared, adjusted R-squared, RMSE (root mean squared error), etc.\n    -   Logistic models: False negative and positive rates, AUC (area under the curve), etc.\n\n-   Make decisions based on model predictive performance, validity across various testing/training splits (aka \"cross validation\"), explainability\n:::\n\n. . .\n\n::: callout-note\nWe will only learn about a subset of these in this course, but you can go further into these ideas in STA 210 or STA 221 as well as in various machine learning courses.\n:::\n\n## ae\\-14\\-chicago\\-taxi\\-classification {.smaller}\n\n::: appex\n-   Go to your ae project in RStudio.\n\n-   If you haven't yet done so, make sure all of your changes up to this point are committed and pushed, i.e., there's nothing left in your Git pane.\n\n-   If you haven't yet done so, click Pull to get today's application exercise file: *ae\\-14\\-chicago\\-taxi\\-classification\\.qmd*.\n\n-   Work through the application exercise in class, and render, commit, and push your edits.\n:::\n",
    "supporting": [
      "21-spending-your-data_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}